<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Neven Repo</title>
  <meta name="description" content="My custom Ksign repo." />
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 0; background: #0b0f1a; color: #e8eefc; }
    .wrap { max-width: 900px; margin: 0 auto; padding: 28px 18px 60px; }
    .card { background: rgba(255,255,255,.06); border: 1px solid rgba(255,255,255,.1); border-radius: 16px; padding: 18px; }
    h1 { margin: 0 0 8px; font-size: 28px; }
    p { margin: 8px 0 0; line-height: 1.5; opacity: .9; }
    .row { display: grid; gap: 12px; margin-top: 16px; }
    .btns { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 16px; }
    a.button { display: inline-block; padding: 10px 14px; border-radius: 12px; text-decoration: none; color: #0b0f1a; background: #7aa2ff; font-weight: 700; }
    a.ghost { background: transparent; color: #e8eefc; border: 1px solid rgba(255,255,255,.2); }
    code { background: rgba(255,255,255,.08); padding: 3px 6px; border-radius: 8px; }
    .small { margin-top: 14px; font-size: 14px; opacity: .8; }
    .list { margin-top: 14px; }
    .app { padding: 10px 12px; border-radius: 14px; border: 1px solid rgba(255,255,255,.12); background: rgba(255,255,255,.04); }
    .app strong { display: block; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>repo.nevip.lol</h1>
      <p>Use the repo link below inside Ksign.</p>

      <div class="btns">
        <a class="button" id="copyBtn" href="#">Copy Repo Link</a>
        <a class="button ghost" id="openJson" href="#">Open index.json</a>
        <a class="button ghost" id="openSite" href="#">Open Website</a>
      </div>

      <p class="small">
        Repo URL: <code id="repoUrl"></code>
      </p>
    </div>

    <div class="row list" id="apps"></div>

    <p class="small">This page reads your <code>index.json</code> and lists apps automatically.</p>
  </div>

  <script>
    // âœ… Your custom domain (no trailing slash)
    const BASE = "https://repo.nevip.lol";

    const repoUrl = `${BASE}/index.json`;
    document.getElementById("repoUrl").textContent = repoUrl;

    document.getElementById("openJson").href = repoUrl;
    document.getElementById("openSite").href = `${BASE}/`;

    document.getElementById("copyBtn").addEventListener("click", async (e) => {
      e.preventDefault();
      try {
        await navigator.clipboard.writeText(repoUrl);
        alert("Copied!");
      } catch {
        prompt("Copy this:", repoUrl);
      }
    });

    async function loadApps() {
      const container = document.getElementById("apps");
      container.innerHTML = "";

      try {
        const res = await fetch(repoUrl, { cache: "no-store" });
        if (!res.ok) throw new Error("Failed to fetch index.json");
        const data = await res.json();

        const apps = Array.isArray(data.apps) ? data.apps : [];
        if (apps.length === 0) {
          container.innerHTML = `<div class="app"><strong>No apps yet</strong><span>Add apps to index.json</span></div>`;
          return;
        }

        for (const app of apps) {
          const div = document.createElement("div");
          div.className = "app";
          div.innerHTML = `
            <strong>${app.name ?? "Unnamed App"}</strong>
            <span>Version: ${app.version ?? "?"}</span><br>
            <span>Bundle: ${app.bundleIdentifier ?? "?"}</span><br>
            <span>${app.description ?? ""}</span>
          `;
          container.appendChild(div);
        }
      } catch (err) {
        container.innerHTML = `<div class="app"><strong>Error</strong><span>${err.message}</span></div>`;
      }
    }

    loadApps();
  </script>
</body>
</html>
